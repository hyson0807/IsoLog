알림기능 및 유료 기능을 추가할꺼야.
현재 캘린더 페이지 상단에 구글 애드몹을 추가했어.
약 복용일인데 저녁 10시가 되어도 복용을 체크하지 않았으면 알림을 보내주는 기능을 추가할껀데,
해당 알림 기능은 유료기능이야. 한번 결제하면 광고제거 + 알림 영구사용가능 하도록 할꺼야.
하지만 결제를 해도 로그인을 유도하진 않을꺼고 설정페이지에서 나중에 동기화를 원하면 로그인을 하도록 할려고해. 이 방식을 사용하기 위해서는 어떤 방식으로 구현을 해야하지? 자세한 방법을 알려줘




로그인을 강제하지 않고 **'기기 중심(Device-first)'**으로 유료 기능을 제공하다가, 나중에 계정을 연동하는 방식은 사용자 경험(UX) 측면에서 이탈률을 줄이는 아주 훌륭한 전략입니다.

이 방식을 구현하기 위해서는 **[로컬 데이터 저장소] + [인앱 결제 시스템(익명 ID)] + [로컬 알림]** 세 가지의 조합이 필요합니다.

개발 관점에서의 상세 구현 로직을 단계별로 정리해 드립니다.

---

### 1. 인앱 결제 구현: "계정 없이 구매 기록 남기기"

로그인이 없어도 앱스토어(Apple/Google) 계정은 기기에 로그인되어 있으므로 결제는 가능합니다. 핵심은 **'이 구매 내역을 어떻게 앱 내에서 관리하느냐'**입니다.

#### A. 익명 ID (Anonymous ID) 시스템
* **원리:** 앱이 처음 설치될 때, 사용자 모르게 **고유한 식별값(UUID)**을 내부적으로 생성하여 기기에 저장합니다.
* **결제 처리:** 사용자가 결제를 하면, 결제 영수증을 이 **익명 ID**와 매핑시킵니다.
* **추천 도구:** **RevenueCat** 같은 인앱 결제 라이브러리를 강력 추천합니다.
    * 이유: RevenueCat은 로그인 없이 '익명 ID'로 구매 내역을 관리하다가, 나중에 사용자가 로그인을 하면 두 정보를 **병합(Merge/Aliasing)**해주는 기능을 완벽하게 지원합니다.

#### B. 구매 복원 (Restore Purchase) 버튼 필수
* 로그인을 안 했기 때문에, 사용자가 앱을 삭제하고 다시 깔면 '익명 ID'가 바뀔 수 있습니다.
* 이때 설정 페이지에 **[구매 내역 복원하기]** 버튼을 반드시 만들어야 합니다.
* 이 버튼을 누르면 앱스토어의 영수증을 다시 확인하여 "아, 이 구글/애플 계정은 이미 샀구나!"라고 인식하고 프리미엄 기능을 활성화해 줍니다.

---

### 2. 알림 구현: "서버가 아닌 로컬 알림(Local Notification)"

로그인을 안 했으므로 서버는 이 사용자가 약을 먹었는지 안 먹었는지 모릅니다. 따라서 알림은 **100% 사용자의 휴대폰 내부(로컬)**에서 처리해야 합니다.

#### 로직 설계 (The 10 PM Rule)

1.  **알림 예약 (Schedule):**
    * 매일 자정(또는 앱을 켤 때), 앱 내부 로직이 판단합니다.
    * *"오늘 약 먹는 날인가?"* -> **YES**
    * *"유료 회원인가?"* -> **YES**
    * **Action:** 오늘 밤 10시에 알림을 예약합니다. (ID: `notification_20251211`)

2.  **알림 취소 (Cancel):**
    * 사용자가 저녁 8시에 앱을 켜서 **[복용 체크]** 버튼을 누릅니다.
    * **Action:** 앱은 즉시 예약되어 있던 `notification_20251211` 알림을 **취소(Cancel)**합니다.
    * 결과적으로 10시에 알림이 울리지 않습니다.

3.  **미복용 시:**
    * 사용자가 10시까지 체크를 안 하면, 취소되지 않은 예약된 알림이 발송됩니다.
    * *"💊 오늘 약 복용 잊지 않으셨나요? 기록을 남겨주세요!"*

---

### 3. 광고 제거 로직

* 앱 시작 시 `SharedPreferences` (안드로이드) 또는 `UserDefaults` (iOS) 같은 로컬 저장소에서 `isPremium` 값을 확인합니다.
* `if (isPremium == true)`라면 광고 위젯(AdMob View)의 높이를 0으로 만들거나 아예 렌더링하지 않습니다.

---

### 4. 나중에 로그인(동기화) 전환 시나리오

사용자가 폰을 바꾸거나 데이터를 백업하고 싶어서 **설정 > 로그인**을 할 때의 처리 방식입니다.

1.  **로그인 시도:** 사용자가 소셜 로그인(구글/애플 등)을 수행합니다.
2.  **식별자 병합 (Identify & Merge):**
    * 기존에 쓰던 **'익명 ID'**와 새로 로그인한 **'유저 ID'**를 결제 서버(RevenueCat 등)에 같이 보냅니다.
    * 서버는 *"이 익명 유저가 샀던 프리미엄 권한을, 이제 이 이메일 계정 소유인 것으로 칠게"*라고 정보를 합칩니다.
3.  **데이터 업로드:**
    * 그동안 로컬 DB(SQLite/Realm)에 쌓였던 캘린더 기록들을 클라우드 데이터베이스(Firebase/AWS)로 일괄 업로드합니다.

---

### 📝 요약: 개발자가 구현해야 할 순서

1.  **앱 실행 시:** UUID 생성 및 로컬 저장. 유료 여부(`isPremium`) 체크.
2.  **결제 시:** 인앱 결제 모듈 호출 -> 성공 시 로컬 `isPremium = true` 저장 -> 광고 뷰 숨김 -> 오늘자 알림 예약 로직 실행.
3.  **복용 체크 시:** 해당 날짜의 예약된 로컬 알림 삭제.
4.  **복용 취소 시(체크 해제):** 다시 오늘 밤 10시 알림 예약.
5.  **설정 페이지:** [구매 복원] 버튼 및 [로그인/데이터 동기화] 버튼 배치.

### 💡 UX 팁
유료 결제 유도를 위해, 설정 페이지의 알림 토글 버튼을 **활성화되어 있지만 잠긴 상태(Dimmed)**로 보여주세요. 토글을 켜려고 터치했을 때, **"이 기능은 프리미엄 기능입니다. 평생 소장하고 광고 없이 이용해보세요!"** 라는 결제 팝업(Paywall)을 띄우는 것이 가장 전환율이 좋습니다.